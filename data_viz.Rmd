---
title: "data_visualization"
author: "Charles Hendrickson"
date: "2023-07-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)

```

Total Average Daily Participation - School Year 
```{r}
#Total Average Daily Participation - School Year 
df_total <- data.frame(meal_type = c("breakfast", "lunch"),
                  participation = c(32543, 100234))


# Create the bar chart
ggplot(df_total, aes(x = meal_type, y = participation, fill = meal_type)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = scales::comma_format()(participation)), vjust = 1.5, color = "black", size = 4) +  # Increase vjust value
  labs(title = "Total Average Daily Participation By Meal Type",
       subtitle = "School Year 2018-2019",
       x = "Meal Type",
       y = "Participation",
       fill = "Meal Type") +  # Specify the legend name
  theme_classic() +
  theme(plot.title = element_text(margin = margin(b = 5)),  # Increase space between title and subtitle
        plot.subtitle = element_text(margin = margin(b = 10)),  # Increase space between subtitle and plot
        axis.text.y = element_text(size = 10))  # Adjust the y-axis label size

```



Total Average Daily Participation By Meal Type - School Year 2018-2019
```{r}
#Total Average Daily Participation By Meal Type - School Year 2018-2019			

# Load the data
df_participation <- data.frame(
  Meal_Type = c("Breakfast", "Lunch"),
  Free = c(22822, 55127),
  Reduced = c(2654, 8976),
  Paid = c(6876, 36131)
)

# Convert to a tidy data set
df_participation <- gather(df_participation, key = "Program_Type", value = "Participation", -Meal_Type)

#Make names lowercase 
df_participation <- clean_names(df_participation)

# Create the bar chart with labels at the top of each stack
ggplot(df_participation, aes(x = meal_type, y = participation, fill = program_type)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = scales::comma_format()(participation)), position = position_stack(vjust = .7), color = "black", size = 4) +  # Position labels at the top
  labs(title = "Total Average Daily Participation By Program Type",
       subtitle = "School Year 2018-2019",
       x = "Meal Type",
       y = "Participation",
       fill = "Program Type") +  # Specify the legend name
  theme_classic() +
  theme(plot.title = element_text(margin = margin(b = 5)),  # Increase space between title and subtitle
        plot.subtitle = element_text(margin = margin(b = 10)),  # Increase space between subtitle and plot
        axis.text.y = element_text(size = 10))  # Adjust the y-axis label size


```



Total Average Daily Participation By Program Type - 6.8% increase for lunch and 12.1% increase for breakfast over 2018-19
```{r}
# Create the tidy dataframe
df_participation_increase <- data.frame(
  Meal_Type = c("Breakfast", "Lunch"),
  Free = c(25583, 58876),
  Reduced = c(2975, 9586),
  Paid = c(7708, 38588)
)

# Convert to a tidy format
df_participation_increase <- pivot_longer(df_participation_increase, cols = -Meal_Type, names_to = "Program_Type", values_to = "Participation")

#Make columns lower case
df_participation_increase <- clean_names(df_participation_increase)

# Create the bar chart with labels at the top of each stack
ggplot(df_participation_increase, aes(x = meal_type, y = participation, fill = program_type)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = scales::comma_format()(participation)), position = position_stack(vjust = .7), color = "black", size = 4) +  # Position labels at the top
  labs(title = "Total Average Daily Participation By Program Type",
       subtitle = "6.8% Increase for Lunch and 12.1% Increase for Breakfast over School Year 2018-19",
       x = "Meal Type",
       y = "Participation",
       fill = "Program Type") +  # Specify the legend name
  theme_classic() + 
  theme(plot.title = element_text(margin = margin(b = 5)),  # Increase space between title and subtitle
        plot.subtitle = element_text(margin = margin(b = 20)),  # Increase space between subtitle and plot
        axis.text.y = element_text(size = 10))  # Adjust the y-axis label size
```

DIFFERENCE Between Actual ADP and 6.8%/12.1% Increase (# of Students)			
```{r}
# Given data in a matrix
data_matrix <- matrix(
  c(2761, 321, 832, 3749, 610, 2457),
  ncol = 3,
  byrow = TRUE,
  dimnames = list(c("Breakfast", "Lunch"), c("Free", "Reduced", "Paid"))
)

# Convert the matrix to a data frame
df_difference <- as.data.frame(data_matrix)

# Remove commas from the numbers and convert to numeric
for (col in names(df_difference)) {
  df_difference[[col]] <- as.numeric(gsub(",", "", df_difference[[col]]))
}

# Add the Meal_Type column
df_difference$Meal_Type <- rownames(df_difference)

# Convert to a tidy data frame
df_difference <- pivot_longer(df_difference, cols = c("Free", "Reduced", "Paid"), names_to = "Program_Type", values_to = "participation_difference")

#make column names lowercase
df_difference <- clean_names(df_difference)
```


```{r}
# Add a new column to indicate the source for tidy_data
df_participation$provision <- "Actual ADP"

# Add a new column to indicate the source for tidy_df
df_participation_increase$provision <- "Increased ADP"

# Combine the data frames
participation_combined <- rbind(df_participation, df_participation_increase)

# Merge the df_difference data frame with the combined data frame and add a difference column 
participation_combined <- merge(participation_combined, df_difference, by = c("meal_type", "program_type"))

# Set participation_difference to 'NA' for rows where provision is 'Current'
participation_combined$participation_difference <- ifelse(participation_combined$provision == "Actual ADP", NA, participation_combined$participation_difference)

# Create the bar chart
ggplot(participation_combined, aes(x = meal_type, y = participation, fill = provision)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.6, color = "black") +
  facet_grid(~program_type) +
  labs(title = "Comparison of Increased School Lunch Participation Rates",
       subtitle = "6.8% Increase for Lunch and 12.1% Increase for Breakfast over School Year 2018-19",
       x = "Meal Type",
       y = "Participation",
       fill = "Program Type") +
  theme_minimal()
```


```{r}
# Create the bar chart with single label for participation_difference
ggplot(participation_combined, aes(x = meal_type, y = participation, fill = provision)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.6, color = "black") +
  facet_grid(~program_type) +
  labs(title = "Comparison of Actual and Increased Total Average Daily Participation (ADP)",
       subtitle = "6.8% Increase for Lunch and 12.1% Increase for Breakfast over School Year 2018-19",
       x = "Meal Type",
       y = "Participation",
       caption = "Values represent the difference between Actual ADP and ADP with 6.8%/12.1% increase.",
       fill = "Program Type") +
  stat_summary(
    aes(label = round(participation_difference, 2)),
    fun = mean,
    geom = "text",
    vjust = -0.5,
    position = position_dodge(width = 0.6),
    show.legend = FALSE
  ) +
  annotate("text", x = 1.5, y = 65000, label = "", size = 5, color = "blue") +
  theme_minimal() +
  theme(plot.title = element_text(size = 14))  # Increase the font size of the title to 17

```


October 2022 NSLP Eligibility By Meal Type - School Year 2021-2022
```{r}
# Create a data frame with the provided data
nslp_eligibility_2022_data <- data.frame(
  Category = c("DOE Public Schools", "Charter Schools - All**", "Charter Schools - Non-CEP", "Private Non-Profit"),
  `Free Eligible` = c(74107, 4919, 321, 77),
  `Reduced Price Eligible` = c(9192, 87, 87, 287),
  `Paid Eligible` = c(76806, 1959, 1429, 372),
  `% Free and Reduced Enrolled` = c("57.6%", "67%*", NA, "22.2%*")
)

# Remove percentage signs and other non-numeric characters from the `% Free and Reduced Enrolled` column
nslp_eligibility_2022_data$`% Free and Reduced Enrolled` <- gsub("[^0-9.]", "", nslp_eligibility_2022_data$`% Free and Reduced Enrolled`, perl = TRUE)

# Convert the column to numeric
nslp_eligibility_2022_data$`% Free and Reduced Enrolled` <- as.numeric(nslp_eligibility_2022_data$`% Free and Reduced Enrolled`)

# Convert to a tidy data frame
data_tidy <- gather(data, key = "Eligibility_Type", value = "Enrolled", -Category, na.rm = TRUE)

# Make column names lowercase
data_tidy <- clean_names(data_tidy)

# Display the resulting tidy data frame
print(data_tidy)

```
















